let reposH={"*":gitUser},totals={nbStars:0,nbForks:0},licensesH={};const repos=gitUser.repos;repos.forEach(e=>{totals.nbStars+=e.nbStars,totals.nbForks+=e.nbForks,reposH[e.name]=e;const t=licensesH[e.licenseName];t?t.repos.push(e.name):licensesH[e.licenseName]={id:e.licenseName,repos:[e.name]}}),gitUser.nbStars=totals.nbStars,gitUser.nbForks=totals.nbForks,gitUser.name="*",fans[gitUser.login]&&delete fans[gitUser.login];const size=e=>5+2*(e.starred.length+e.forked.length),userColorGroup=e=>e.forked.length?e.starred.length?"both":"fork":e.follower?"follower":"star",getData=()=>{let r=[],o=[];for(var t in repos.forEach((e,t)=>{e.group=t+2,r.push({id:e.name,oType:"repo",radius:Math.min(10+e.nbStars/10,100),group:e.group,isRepo:!0}),o.push({source:"*",target:e.name,value:4})}),repos.push({name:"*",description:"Evoluteur"}),r.push({id:"*",radius:20,group:0,isRepo:!0}),fans){const s=fans[t];r.push({id:t,radius:size(s),oType:"user",group:userColorGroup(s)}),s.starred.forEach(e=>o.push({source:t,target:e,value:1})),s.forked.forEach(e=>{s.starred.includes(e)||o.push({source:t,target:e,value:1})})}return{nodes:r,links:o}},height=config.height||2e3,width=config.width||2500,userColors=config.userColors,colorFaded=config.colorFaded||"#eeeeee",circleBorder=config.circleBorder||"white",lineColor=config.lineColor||"white",scaleProject=d3.scaleOrdinal(d3.schemeCategory10),color=e=>e.isRepo?scaleProject(e.group):userColors[e.group],linksDistance=config.linksDistance||50,linksCharge=config.linksDistance||-30,drag=t=>{return d3.drag().on("start",e=>{e.active||t.alphaTarget(.3).restart(),e.subject.fx=e.subject.x,e.subject.fy=e.subject.y}).on("drag",e=>{e.subject.fx=e.x,e.subject.fy=e.y}).on("end",e=>{e.active||t.alphaTarget(0),e.subject.fx=null,e.subject.fy=null})};let selectedRepo=null;const graph=e=>{var t=e.links,e=e.nodes,o=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);const r=d3.forceSimulation(e).force("link",d3.forceLink(t).distance(50).id(e=>e.id)).force("charge",d3.forceManyBody().strength(-30)).force("center",d3.forceCenter(width/2,height/2)).force("collision",d3.forceCollide().radius(e=>e.radius)),s=d3.create("svg").attr("viewBox",[0,0,width,height]).on("click",hideDetails),i=s.append("g");s.call(d3.zoom().extent([[0,0],[width,height]]).scaleExtent([1,8]).on("zoom",({transform:e})=>{i.attr("transform",e)}));const l=i.attr("stroke",lineColor).selectAll("line").data(t).join("line").attr("stroke-width",1),a=i.attr("stroke","#fff").attr("stroke-width",1.5).selectAll("circle").data(e).join("circle").attr("id",e=>e.id).attr("r",e=>e.radius).attr("stroke",circleBorder).attr("fill",color).attr("class",e=>e.oType).call(drag(r)).on("click",showDetails).on("mouseover",(e,t)=>{o.transition().duration(200).delay(400).style("opacity",.9);const r=o.html(t.isRepo?repoItem(reposH[t.id]):userTooltip(t));e.pageX+100>window.innerWidth?r.style("left",window.innerWidth-100+"px"):r.style("right",null).style("left",e.pageX+20+"px"),r.style("bottom",null).style("top",e.pageY+10+"px")}).on("mouseout",(e,t)=>{o.transition().duration(200).style("opacity",0)});return r.on("tick",()=>{l.attr("x1",e=>e.source.x).attr("y1",e=>e.source.y).attr("x2",e=>e.target.x).attr("y2",e=>e.target.y),a.attr("cx",e=>e.x).attr("cy",e=>e.y)}),s.node()},hideDetails=e=>{d3.selectAll("circle").transition().duration(600).style("fill",color).style("stroke",circleBorder),d3.selectAll("line").transition().duration(600).style("stroke",lineColor),selectedRepo=null},showDetails=(e,r)=>{if(e.stopPropagation(),"rgb(238, 238, 238)"===e.target.style.fill&&"repo"!==r.oType)return null;if(!e.detail.skipModal){const s=document.getElementById("details");s.innerHTML=(r.isRepo&&"*"!==r.id?infoRepo:infoUser)(r.id),s.className=(r.x>width/2?"left":"right")+(r.isRepo?" w220":"")}let t,o=e=>r.id!==e.source.id&&r.id!==e.target.id;"repo"===r.oType?(selectedRepo=r.id,t=e=>{if("repo"===e.oType)return r.id!==e.id||""==e.id;{const t=fans[e.id];return!!t&&!(t.starred.includes(r.id)||t.forked.includes(r.id))}},d3.selectAll("circle").transition().duration(600).style("fill",e=>t(e)?colorFaded:color(e)).style("stroke",e=>t(e)?"#0288d1":circleBorder),d3.selectAll("line").transition().duration(600).style("stroke",e=>o(e)?colorFaded:lineColor).filter(e=>!o(e))):"user"===r.oType?(t=e=>{const t=fans[r.id];return!(t.starred.includes(e.id)||t.forked.includes(e.id))},o=e=>r.id===e.source.id,selectedRepo&&(d3.selectAll("circle.repo").transition().duration(600).style("fill",e=>t(e)?colorFaded:color(e)),o=e=>r.id===e.source.id,d3.selectAll("line").transition().duration(600).filter(o).style("stroke",lineColor))):hideDetails()},selectProject=e=>{var t=new CustomEvent("click",{detail:{skipModal:!0}});const r=document.getElementById(e);r&&r.dispatchEvent(t)},renderGraph=()=>{document.getElementById("graph").appendChild(graph(getData())),document.getElementById("details").onclick=e=>e.stopPropagation(),document.onclick=()=>document.getElementById("details").className=""},eMap={},$=e=>{var t=eMap[e];if(t)return t;t=document.getElementById(e);return t&&(eMap[e]=t),t},refreshRepos=(e,t)=>{$("reposList").innerHTML=repoList(e,!1,!0,!0),t&&($("summary-count").innerHTML='<span class="summary">'+t+"</span>")},onSearch=(e,t)=>{const r=e?.currentTarget?.value;var o,s=repos?.length||0;r?(e=(o=repos.filter(e=>e.name.includes(r))).length,refreshRepos(o,e+" / "+s)):refreshRepos(repos,s)};let sortDirection=1,lastSortKey="n";const onSort=(e,t)=>{e.stopPropagation(),lastSortKey===t?sortDirection=-sortDirection:(sortDirection=1,lastSortKey=t);t="s"===t?(e,t)=>sortDirection*(t.nbStars-e.nbStars):(e,t)=>sortDirection*e.name.localeCompare(t.name);refreshRepos(repos.sort(t))},searchBox=()=>`<div class="field-holder"><input type="text class="field" onkeyup="javascript:onSearch(event,this)"/><span id="summary-count">${repos?.length||""}</span></div>`,sortOptions=()=>`<div class="field-holder">
  <div class="sort-dir" onclick="javascript:onSort(event, 'n')"/>N</div>/<div class="sort-dir" onclick="javascript:onSort(event, 's')"/>S</div>
  </div>`,repoArr=e=>e.sort((e,t)=>e.localeCompare(t)).map(e=>"*"===e?gitUser:reposH[e]),textField=(e,t)=>t?`<div class="field"><label>${e}:</label> ${t}</div>`:"",urlField=(e,t)=>e[t]?`<div class="field ellipsis">
    <div class="icon link"></div> <a href="${e[t]}" target="${e.name}" rel="noopener">${e[t]}</a>
  </div>`:"",icon=e=>'<div class="icon '+e+'"></div>',condIcon=(e,t)=>t?icon(e)+`<span>${t}</span>`:"",infoRepo=t=>{const e=repos.find(e=>e.name===t);var o="";return o+=`<h1><a href="${`https://github.com/${gitUser.login}/`+e.name}" target="${e.name}">
      <div class="repo-circle" style="background-color:${color({isRepo:!0,name:e.name||r.id,group:e.group})}"></div>
      ${e.name}
    </a></h1>`,o+=urlField(e,"homepageUrl")+repoItemPop(e)+(e.description?`<div class="field">${e.description}</div>`:"")+textField("Updated",e.updatedAt)+textField("Created",e.createdAt),o+=e.licenseInfo?`<div class="field multi">${icon("license")}<a href="${e.licenseInfo.url}" target="${e.licenseInfo.key}" rel="noopener">${e.licenseInfo.name}</a></div>`:"",o+=e.languages&&e.languages.length?e.languages.map(e=>`<span><div style="background-color:${e.color}" class="ln-dot"></div>${e.name}</span>`).join(""):"",o+=htmlTopics(e.topics)},avatarPix=(e,t)=>`<div class="${t}"><img src="${e}"></div>`,userTooltip=e=>avatarPix(fans[e.id].avatarUrl,"avatar-small")+e.id+textField("Updated",e.updatedAt),infoUser=e=>{var t="*"===e?gitUser:fans[e];let r="";var o=t.login===gitUser.login,e="https://github.com/"+t.login;return r+=t.avatarUrl?'<div class="h190"><img src="'+t.avatarUrl+'"></div>':"",r+=`<h1><a href="${e}" target="${t.login}">${t.login}</a></h1>`,r+=t.fullName?`<div class="fullName">${t.fullName}</div>`:"",r+=urlField(t,"websiteUrl")+urlField(t,"webURL"),r+=t.location?`<div class="field"><div class="icon location"></div> <span>${t.location}</span></div>`:"",r+=t.bio?`<div class="field">${t.bio}</div>`:"",r+='<div class="field multi">',r+=t.nbFollowers?`${icon("followers")}<a href="https://github.com/${t.login}?tab=followers" target="${"follow_"+t.name}" rel="noopener">${t.nbFollowers}</a>`:"",r+=o?condIcon("star",t.nbStars)+condIcon("fork",t.nbForks):t.nbRepos?`${icon("repos")}<a href="https://github.com/${t.login}?tab=repositories" target="${t.name}" rel="noopener">${t.nbRepos}</a>`:"",r+="</div>",o?r+=searchBox()+sortOptions()+repoList(gitUser.repos,!0,!0):(t.starred&&t.starred.length&&(r+='<div class="field"><label>Starred: '+t.starred.length+"</label>"+repoList(repoArr(t.starred),!1,!0)+"</div>"),t.forked&&t.forked.length&&(r+='<div class="field"><label>Forked: '+t.forked.length+"</label>"+repoList(repoArr(t.forked),!1,!0)+"</div>")),r},repoList=(e,t,r,o)=>{var s=e.map(e=>repoItem(e,t)).join(""),e=r?"":'<span class="repoIco">'+icon("repos")+" "+e.length+"</span>";return o?s:'<div id="reposList" class="reposList">'+e+s+"</div>"},repoItem=(e,t)=>{var r=e.login||"*"===e.name;if(r&&t)return"";var o=r?e.login:e.name;if(!o)return"";t=r?e.login:gitUser.login+"/"+e.name;return`
      <div onclick="javascript:selectProject('${e.name}')" class="project">
        <a class="${r?"gituser":""}" href="javascript:selectProject('${e.name}')">
          <div class="repo-circle" style="background-color:${color({isRepo:!0,group:r?0:e.group})}"></div>
        </a>
        <a class="${r?"gituser":""}" href="https://github.com/${t}" target="${o}" rel="noopener">
          ${o}
        </a>
        ${r?`<div class="field multi">
          ${condIcon("followers",e.nbFollowers)}
          ${condIcon("star",e.nbStars)}
          ${condIcon("fork",e.nbForks)}
        </div>`:repoItemPop(e)}
      </div>
    `};let topicList=[];const maxTopics=config.maxTopics||3,htmlTopic=e=>`<div><a href="https://github.com/topics/${e}" target="t_${e}">${e}</a></div>`,htmlTopics=e=>'<div id="my_topics" class="field topics">'+(topicList=e).slice(0,maxTopics).map(htmlTopic).join("")+(e.length>maxTopics?'<div class="morelink" onclick="moreTopics(event)">+ '+(e.length-maxTopics)+" more...</div>":""),moreTopics=e=>{e.stopPropagation(),document.getElementById("my_topics").innerHTML=topicList.map(htmlTopic).join("")},repoItemPop=e=>{var t=`https://github.com/${gitUser.login}/${e.name}/`,r=` target="${e.name}" rel="noopener"`;return`
<div class="field multi">
  ${e.nbStars?`${icon("star")}<a href="${t}stargazers" ${r}>${e.nbStars}</a>`:""}
  ${e.nbForks?`${icon("fork")}<a href="${t}network/members" ${r}>${e.nbForks}</a>`:""}
  ${e.version?`${icon("tag")}<a href="${t}releases/tag/${e.version}" ${r}>${e.version}</a>`:""}
</div>
`};